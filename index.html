<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subdomain Application</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>body { font-family: 'Inter', sans-serif; background-color: #0f172a; }</style>
</head>
<body class="flex items-center justify-center min-h-screen p-4 text-white">

    <div class="w-full max-w-lg bg-gray-800/50 backdrop-blur-lg border border-gray-700 rounded-3xl shadow-2xl p-8 relative overflow-hidden">
        <div class="absolute top-0 left-1/2 -translate-x-1/2 w-40 h-1 bg-blue-500 rounded-b-full shadow-[0_0_40px_rgba(59,130,246,0.6)]"></div>

        <h2 class="text-3xl font-bold text-center mb-8 bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">
            Subdomain Application
        </h2>
        
        <form id="subdomainForm" class="space-y-6">
            <div>
                <label class="block text-sm text-gray-400 mb-2">Desired Subdomain</label>
                <div class="flex items-center bg-gray-900/50 border border-gray-600 rounded-xl focus-within:border-blue-500 transition-all">
                    <input type="text" id="subdomain" required placeholder="mysite" pattern="^[a-zA-Z0-9-]+$"
                        class="w-full bg-transparent px-4 py-3 outline-none text-blue-100 placeholder-gray-600">
                    <span class="pr-4 text-gray-500 font-mono text-sm">.modoku.click</span>
                </div>
            </div>

            <div>
                <label class="block text-sm text-gray-400 mb-2">Target URL (CNAME)</label>
                <input type="text" id="target" required placeholder="example.com"
                    class="w-full bg-gray-900/50 border border-gray-600 rounded-xl px-4 py-3 outline-none focus:border-blue-500 text-blue-100">
            </div>
            <div>
                <label class="block text-sm text-gray-400 mb-2">Your Email Address</label>
                <input type="email" id="userEmail" required placeholder="your@email.com"
                    class="w-full bg-gray-900/50 border border-gray-600 rounded-xl px-4 py-3 outline-none focus:border-blue-500 text-blue-100">
            </div>

            <div>
                <label class="block text-sm text-gray-400 mb-2">Purpose</label>
                <textarea id="purpose" required rows="3" placeholder="Usage details..."
                    class="w-full bg-gray-900/50 border border-gray-600 rounded-xl px-4 py-3 outline-none focus:border-blue-500 text-blue-100"></textarea>
            </div>

            <div>
                <label class="block text-sm text-gray-400 mb-2">TTL</label>
                <select id="ttl" class="w-full bg-gray-900/50 border border-gray-600 rounded-xl px-4 py-3 outline-none focus:border-blue-500 text-blue-100">
                    <option value="60">60s (Fastest)</option>
                    <option value="300" selected>300s (Standard)</option>
                </select>
            </div>

            <button type="submit" id="submitBtn"
                class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white font-bold py-4 rounded-xl shadow-lg transition active:scale-[0.98]">
                Submit for Review
            </button>
        </form>

        <div id="message" class="hidden mt-6 p-4 rounded-xl bg-gray-700/50 text-center text-sm border border-gray-600"></div>
    </div>

    <script>
        // ★ここにGASのウェブアプリURLを貼り付けてください
        const GAS_ENDPOINT = "https://script.google.com/macros/s/AKfycbymtTBanuI_wRLCmUMtwMXkLziyoSYOeDneBC2WPpoR-Y3TQPw4A4ZN3dV0sTYSK_yO/exec";

        document.getElementById('subdomainForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const btn = document.getElementById('submitBtn');
            const msg = document.getElementById('message');
            
            btn.disabled = true;
            btn.innerText = "Sending...";
            msg.classList.add('hidden');

            const formData = {
                subdomain: document.getElementById('subdomain').value + ".modoku.click",
                target: document.getElementById('target').value,
                ttl: document.getElementById('ttl').value,
                purpose: document.getElementById('purpose').value,
                userEmail: document.getElementById('userEmail').value, // ★これを追加
                timestamp: new Date().toLocaleString("ja-JP")
            };

            try {
                // CORSエラー回避のため、標準のPOSTとして送る（GAS側で受け取る工夫済み）
                await fetch(GAS_ENDPOINT, {
                    method: "POST",
                    body: JSON.stringify(formData),
                    // mode: "no-cors", // 必要であれば有効化しますが、レスポンスが見れなくなります
                    headers: {
                        "Content-Type": "text/plain;charset=utf-8"
                    }
                });

                // GASからのレスポンスはCORSの関係で見れない場合が多いですが、
                // エラーが出なければ送信成功とみなします。
                msg.innerHTML = `
                    <span class="text-green-400 font-bold block mb-1">✔ 登録が完了しました！</span>
                    <span class="text-gray-300">数分以内にDNS設定が世界中に反映されます。<br>ご登録のターゲットURLへ接続できるかお試しください。</span>
                `;
                msg.classList.remove('hidden');
                document.getElementById('subdomainForm').reset();
            } catch (error) {
                console.error(error);
                msg.innerHTML = `<span class="text-red-400">❌ Error occurred. Please try again.</span>`;
                msg.classList.remove('hidden');
            } finally {
                btn.disabled = false;
                btn.innerText = "Submit for Review";
            }
        });
    </script>
</body>
</html>
